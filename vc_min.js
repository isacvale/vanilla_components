var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var VCSearch=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/vc_components/";_classCallCheck(this,e),this.codeBlock=t,this.components_path=n,this.component_cache={vc_script:"",vc_style:"",vc_components:[]},this.loadCount=0,this.listOfComponents=[],this.vc_array=t.getElementsByTagName("vc");for(var o=0;o<this.vc_array.length;o++)this.listOfComponents.push(this.vc_array[o])}return _createClass(e,[{key:"loadComponent",value:function(){var e=this.listOfComponents.pop();if(e.innerHTML in this.component_cache)this.processNewComponent(e);else{this.loadCount+=1;var t=new XMLHttpRequest,n=this,o=this;t.onreadystatechange=function(){var t=this.DONE||4;this.readyState===t&&n.processNewComponent(e,o.parseHTML(this.response))};var r=this.components_path+e.innerHTML+".html";t.open("GET",r,!0),t.send(null)}}},{key:"parseHTML",value:function(e){var t=new RegExp("(<script>.*<\/script>|<style>.*</style>)","gms"),n={markup:e.replace(t,"").trim()},o=new RegExp("<style>(.*)</style>","gms").exec(e);o&&(n.style=o[1]);var r=new RegExp("<script>(.*)<\/script>","gms").exec(e);return r&&(n.script=r[1]),console.log("parsed data ---v"),console.log(n),n}},{key:"processNewComponent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.innerHTML,o=null,r="";t?(r=t.markup,this.component_cache[e.innerHTML]=r):r=this.component_cache[n],o=this.switchContents(e,r),this.component_cache.vc_components.push([n,o]),this.addComponentsToQueue(o),o.setAttribute("vc",n),o.setAttribute("vc_c",n),t?(t.style&&(this.component_cache.vc_style+=t.style),t.script&&(this.component_cache.vc_script+=t.script),console.log("component_cache---v"),console.log(this.component_cache),this.listOfComponents.length>0&&this.loadComponent(),this.loadCount-=1,0==this.loadCount&&this.loadComplements()):this.listOfComponents.length>0&&this.loadComponent()}},{key:"loadComplements",value:function(){this.injectCSS(),this.injectJS(),this.constructComponents()}},{key:"addComponentsToQueue",value:function(e){for(var t=e.getElementsByTagName("vc"),n=0;n<t.length;n++)this.listOfComponents.push(t[n])}},{key:"injectCSS",value:function(){var e=document.createElement("style");e.innerHTML=this.component_cache.vc_style,document.getElementsByTagName("head")[0].prepend(e)}},{key:"injectJS",value:function(){var e=document.querySelector("body>script");(o=document.createElement("script")).innerHTML=this.component_cache.vc_script,document.body.insertBefore(o,e);for(var t=document.querySelectorAll("body>script"),n=1;n<t.length;n++){var o;if("vanilla_components.js"!=(o=t[n]).getAttribute("src")&&o.hasAttribute("vc")){var r=document.createElement("script");null!=o.getAttribute("src")&&r.setAttribute("src",o.getAttribute("src")),document.body.insertBefore(r,o),r.innerHTML=o.innerHTML,document.body.removeChild(o)}}}},{key:"constructComponents",value:function(){for(var e,t=document.querySelectorAll("[vc_c]"),n=[],o=0;o<t.length;o++)null!=t[o]&&n.push(t[o]);var r=!0,c=!1,s=void 0;try{for(var i,a=n[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var l=i.value;e="vc_"+l.getAttribute("vc_c"),"function"==typeof window[e]&&window[e](l),l.removeAttribute("vc_c")}}catch(e){c=!0,s=e}finally{try{!r&&a.return&&a.return()}finally{if(c)throw s}}}},{key:"cloneAttributes",value:function(e,t){for(var n=void 0,o=0;o<e.attributes.length;o++)if("$"==(n=e.attributes[o]).name.charAt(0))new RegExp("\\"+n.name,"g");console.log("to el after",t,t.outerHTML),console.log(document)}},{key:"switchContents_test",value:function(e,t){var n=this.stringToMarkup(t);console.log(">",n)}},{key:"switchContents",value:function(e,t){for(var n=[],o=0;o<e.attributes.length;o++)n.push([e.attributes[o].name,e.attributes[o].value]);var r=document.createElement("span");r.id="vc_first_anchor",e.parentElement.insertBefore(r,e),e.outerHTML=t;var c=document.getElementById("vc_first_anchor").nextSibling,s=document.createElement("span");s.id="vc_second_anchor",c.parentElement.insertBefore(s,c);var i=void 0,a=c.outerHTML,l=!0,u=!1,h=void 0;try{for(var p,v=n[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var m=p.value;"$"==m[0].charAt(0)&&(i=new RegExp("\\"+m[0],"g"),a=a.replace(i,m[1]))}}catch(e){u=!0,h=e}finally{try{!l&&v.return&&v.return()}finally{if(u)throw h}}c.outerHTML=a;var d=document.getElementById("vc_second_anchor").nextSibling;return r.parentElement.removeChild(r),s.parentElement.removeChild(s),"<tr"!=t.substring(0,3)&&"<td"!=t.substring(0,3)||(d=d.parentElement),d}},{key:"stringToMarkup",value:function(e){var t=document.createElement("span");return t.innerHTML=e.trim(),console.log("@",t.firstChild),t.firstChild}},{key:"get_inserted",value:function(e){for(var t=e.previousSibling;1!=t.nodeType;)t=t.previousSibling;return t}}]),e}(),vc_search=new VCSearch;vc_search.loadComponent();
