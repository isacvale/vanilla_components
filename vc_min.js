var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var VCSearch=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/vc_components/";_classCallCheck(this,e),this.codeBlock=t,this.components_path=n,this.component_cache={vc_script:"",vc_style:"",vc_components:[]},this.loadCount=0,this.listOfComponents=[],this.vc_array=t.getElementsByTagName("vc");for(var r=0;r<this.vc_array.length;r++)this.listOfComponents.push(this.vc_array[r])}return _createClass(e,[{key:"loadComponent",value:function(){var e=this.listOfComponents.pop();if(e.innerHTML in this.component_cache)this.processNewComponent(e);else{this.loadCount+=1;var t=new XMLHttpRequest,n=this;t.onreadystatechange=function(){var t=this.DONE||4;this.readyState===t&&n.processNewComponent(e,n.parseHTML(this.response))};var r=this.components_path+e.innerHTML+".html";t.open("GET",r,!0),t.send(null)}}},{key:"parseHTML",value:function(e){var t=new RegExp("(<script>.*<\/script>|<style>.*</style>)","gms"),n={markup:e.replace(t,"").trim()},r=new RegExp("<style>(.*)</style>","gms").exec(e);r&&(n.style=r[1]);var o=new RegExp("<script>(.*)<\/script>","gms").exec(e);return o&&(n.script=o[1]),n}},{key:"processNewComponent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.innerHTML,r=null,o="";t?(o=t.markup,this.component_cache[e.innerHTML]=o):o=this.component_cache[n],r=this.switchContents(e,o),this.component_cache.vc_components.push([n,r]),this.addComponentsToQueue(r),r.setAttribute("vc",n),r.setAttribute("vc_c",n),t&&(t.style&&(this.component_cache.vc_style+=t.style),t.script&&(this.component_cache.vc_script+=t.script)),this.areAllLoaded()}},{key:"areAllLoaded",value:function(){this.listOfComponents.length>0?(this.loadComponent(),this.loadCount-=1):this.loadComplements()}},{key:"loadComplements",value:function(){this.injectCSS(),this.injectJS(),this.constructComponents()}},{key:"addComponentsToQueue",value:function(e){for(var t=e.getElementsByTagName("vc"),n=0;n<t.length;n++)this.listOfComponents.push(t[n])}},{key:"injectCSS",value:function(){var e=document.createElement("style");e.innerHTML=this.component_cache.vc_style,document.getElementsByTagName("head")[0].prepend(e)}},{key:"injectJS",value:function(){var e=document.querySelector("body>script");(r=document.createElement("script")).innerHTML=this.component_cache.vc_script,document.body.insertBefore(r,e);for(var t=document.querySelectorAll("body>script"),n=1;n<t.length;n++){var r;if("vanilla_components.js"!=(r=t[n]).getAttribute("src")&&r.hasAttribute("vc")){var o=document.createElement("script");null!=r.getAttribute("src")&&o.setAttribute("src",r.getAttribute("src")),document.body.insertBefore(o,r),o.innerHTML=r.innerHTML,document.body.removeChild(r)}}}},{key:"constructComponents",value:function(){for(var e,t=document.querySelectorAll("[vc_c]"),n=[],r=0;r<t.length;r++)null!=t[r]&&n.push(t[r]);var o=!0,c=!1,s=void 0;try{for(var a,i=n[Symbol.iterator]();!(o=(a=i.next()).done);o=!0){var l=a.value;e="vc_"+l.getAttribute("vc_c"),"function"==typeof window[e]&&window[e](l),l.removeAttribute("vc_c")}}catch(e){c=!0,s=e}finally{try{!o&&i.return&&i.return()}finally{if(c)throw s}}}},{key:"cloneAttributes",value:function(e,t){for(var n=void 0,r=0;r<e.attributes.length;r++)if("$"==(n=e.attributes[r]).name.charAt(0))new RegExp("\\"+n.name,"g")}},{key:"switchContents",value:function(e,t){for(var n=[],r=0;r<e.attributes.length;r++)n.push([e.attributes[r].name,e.attributes[r].value]);var o=document.createElement("span");o.id="vc_first_anchor",e.parentElement.insertBefore(o,e),e.outerHTML=t;var c=document.getElementById("vc_first_anchor").nextSibling,s=document.createElement("span");s.id="vc_second_anchor",c.parentElement.insertBefore(s,c);var a=void 0,i=c.outerHTML,l=!0,u=!1,h=void 0;try{for(var p,m=n[Symbol.iterator]();!(l=(p=m.next()).done);l=!0){var v=p.value;"$"==v[0].charAt(0)&&(a=new RegExp("\\"+v[0],"g"),i=i.replace(a,v[1]))}}catch(e){u=!0,h=e}finally{try{!l&&m.return&&m.return()}finally{if(u)throw h}}c.outerHTML=i;var d=document.getElementById("vc_second_anchor").nextSibling;return o.parentElement.removeChild(o),s.parentElement.removeChild(s),"<tr"!=t.substring(0,3)&&"<td"!=t.substring(0,3)||(d=d.parentElement),d}}]),e}(),vc_search=new VCSearch;vc_search.loadComponent();
